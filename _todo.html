<html>
<head>
<title>Mafia Ratings todo list</title>
<META content="text/html; charset=utf-8" http-equiv=Content-Type>
</head>
<body>

<h3>Features:</h3>
<ul>
<li>Изменения регистра у пользователя не сохраняются. Например, Fantomas -> fantomas</li>
<li>Cleanup mr.js. Перенести все функции, которые используются только один раз в файлы где они используются.</li>
<li>Рассадки.</li>
<li>Сделать возможность смотреть турнирную таблицу турниров "до начала N игры M раунда". То же самое по сериям: до турнира N. Возможность прятать таблицу начиная с раунда N и тогда показывать таблицу только до него.</li>
<li>Починить историю (поле log в current_game). Понять, почему история пропадает.</li>
<li>Notifications/messages внутри сайта вместо емайлов. А емайл единый на все нотификации.</li>
<li>Текстовые трансляции.</li> 
<li>Сделать в серийной системе подсчета баллов условие для исключения баллов турнира из серии. Причина: iMafia Finals имеет 0 звезд и приносит 0 баллов, но участвует в отсечении. Надо его из отсечения исключить.</li>
<li>Пауза в игре, которая переключает OBS на паузу.</li>
<li>Привязка игр к видео через OBS Studio.</li>
<li>Ввод игроков без email в игру.</li>
<li>Пусть лучше mafiaratings сама определяет, какие игры рейтинговые, а какие нет. Разделить рейтинговость в смысле зачета в соревнование турнира и в смысле зачета в рейтинг. Чекбокс в игре будет означать зачет в турнир.</li>
<li>Reusing pictures.</li>
<li>Сделать специальные лого пользователей для турниров/клубов в диалоге редактирования регистрации вместо отдельной кнопки.</li>
<li>Клубные серии.</li>
<li>New look и удобства на мобильниках.</li>
<li>Пересчитывать гостевой коэфициент турниров когда lat/lon адреса меняется. То же самое для городов менять гостевой коэф турниров по всем адресам этого города и при участии всех игроков этого города. Сделать в починке возможность восстановить lat/lon городов/адресов, у которых они 0.</li>
<li>Получать у youtube на какой секунде находится стрим и автоматически привязывать видео к играм.</li>
<li>У normailzer нет viewer. Если нажать на нормалайзер, то идет диалог с отсутствующим контентом.</li>
<li>Проверить сохранение сезонных систем подсчета баллов. У меня AML перезаписалась когда я сохранил.</li>
<li>Поддержать полуфиналы-финалы и тому подобное в сериях. Выводить их результаты в таблицу серии. Сделать отдельные gaining systems на разные раунды. Поддержать в gaining, чтобы сумма баллов турниров были результатом серии (с коэф).</li>
<li>В complete_competitions.php исправлять времена турниров и евентов по времени начала первой игры и конца последней.</li>
<li>Сделать настраиваемое количество звезд в турнирных сериях. И чекбокс если бывает половина звезды.</li>
<li>Добавить победителей в списки турниров, евентов и серий.</li>
<li>Заменить все аппрувы на уведомления. Система аппрувов слишком громоздкая.</li>
<li>Разделить замечания и тех фолы в статистике и в настройках игры (см KILL_TYPE_WARNINGS, SCORING_FLAG_WARNINGS_4, GAME_FEATURE_FLAG_WARNINGS).</li>
<hr>

<li>Разбить голосование и статы по нему по 24 категориям: (критика/не критика) (выводящее/попил/не выводящее) (в мафа/мирного/дона/шерифа). Показывать прямо в виде таблицы. <a href="#voting">См комментарии.</a></li>
<li>Посмотреть игру 5548. Там в нулевой день стол поделился и нет переголосования. Надо в этом случае генерить ошибку. А впрочем, лучше тихо исправлять.</li>
<li>Применить турнирные регистрации к раундам группы основного раунда. Кажется уже сделано, но я не уверен. Проверить.</li>
<li>Сделать тестовую игру для турнира, чтобы на ней испытывать плагины к OBS. Игру можно сыграть до турнира, но регистрации сделанные на ней останутся.</li>
<li>Сделать нормальный редактор игр</li>
<li>Вывести протесты во view game. Ликвидировать отдельную страницу для протестов.</li>
<li>Уменьшить все значения в полях sheriff_found и sheriff_arranged в таблице dons на единицу.</li>
<li>Продление евента не нужно. Продлевать если пришла новая игра. Продумать, как это сделать так, чтобы евент не продлевался бесконечно.</li>
<li>Сделать таблицу для командных турниров с ручным управлением результатами. Вообще, переместить всю логику ручного управления результатами в функцию tournament_scores, а собственно показ результатов сделать независимым от этого.</li>
<hr>

<li>Сделать простую возможность в турнирах переносить игры между раундами.</li>
<li>Сделать страницы по городам и странам - игроки, клубы, турниры, игры, близлежащие города.</li>
<li>Убедиться, что cancel game работает и перестраивает рейтинги. Что запись canceled игры перестраивает рейтинги. Подумать не включить ли cancel в лог игры и не объединить ли с fun (rating: false).</li>
<li>В показе игры сделать так, что бы кнопки "след игра" и "предыд игра" учитывали фильтр с которым туда пришли. Например, если попадаем из списка где видны только видео, то и навигация должна быть только по играм с видео.</li>
<li>Отмена турниров.</li>
<li>Починить страницу api/get/scoring и сделать ее рабочей для турниров</li>
<li>Сделать возможность редактировать scoring systems, normilizers и gaining systems в специфической версии. Сейчас любое редактирование создает новую версию.</li>
<hr>

<li>Подчищать пустые евенты и турниры. Сделать там поле last_change и если оно старше недели, удалять пустой турнир/event.</li>
<li>Приделать назад протесты против игры. См. view_game_objections.php</li>
<li>Сделать так, чтобы можно было редактировать уже используемые версии scoring/normalizer/gaining systems. Сейчас при редактировании старая версия остается неизменной и создается новая. Но иногда нужно именно поменять старую (например если там ошибка).</li>
<li>Баг. Если евент добавить как раунд турнира уже после проведения, то игры евента не прибавляются к турниру. Видимость евента тоже не меняется (подумать, должна ли). И наоборот, если убрать из турнира, то игры не исключаются.
<li>Баг график хода соревнования для евентов и турниров показан задом наперед.</li>
<li>Баг. Если выбрать другую систему подсчета баллов в турнирной таблице игрового дня, то page навигация перестает работать.</li>
<li>В фиимовской форме сдавшемуся игроку не начисляются минусы. При этом в таблице mafiaratings они есть. Посмотреть, почему.</li>
<li>В турнирах надо где-то показывать веса раундов и правила начисления. Чтобы всем было видно.</li>
<li>Пост незалогинившись в чат не дает диалога для логина, а дает просто not enough permissions. Это неудобно.</li>
<li>SCORING_DEFAULT_ID захардкодирован на ФИИМ. Брать вместо него из базы данных самый часто используемый.</li>
<li>Баг. Невозможно поменять первую букву имени на ту же букву, но uppercase/lowercase.</li>
<li>Баг. К игре 5032 не цепляется видео: </li>
<li>Баг. Если внутри турнира создать раунд, который сильно выпадает по времени из турнира, то возникают странные штуки. Например если редактировать раунд, то турнира которому он принадлежит нет в списке.</li>
<li>Сделать при редактировании евентов флаг "не показывать евент до начала".</li>
<li>Доделать страницы лиги.</li>
<li>/api/get/games.php - сделать возможность фильтровать по правилам (rules=*******1***3) и по game_features (must_have=vnd). Сделать возможным не показывать выбранные game features (exclude=vd).</li>
<li>Сделать возможность в игре убирать замечания не откатывая до момента замечания.</li>
<li>Сделать в клубе default address. При создании event/tournament сделать чекбокс позволяющий сделать этот адрес постоянным (default). Такой же чекбокс сделать для scoring и normalizer (причем в их случае и для лиг тоже).</li>
<li>При создании/редактировании турнира проверять правила на соответствие лиге на лету. Каждый раз когда лига выбирается из комбобокса.</li>
<li>Сделать help для scoring systems и normalizers в get и ops API. Сейчас их формат не описан.</li>
<li>Восстановить демо сервер и организовать простую систему по его апгрейду.</li>
<li>В списках игр и во вьювере игры надо видеть опротестована ли игра. Неплохо бы создать список событий нуждающихся в ответе и посадить сверху иконку со ссылкой туда. Это должны быть протесты, запросы на создание клуба, приглашения на евенты и вообще все, на что присылается емайл.</li>
<li>Объединить get и ops API. В принципе нет особых причин им быть раздельными. Get может быть просто одной из ops.</li>
<li>Избавиться от класса Event. Он только лишнюю работу делает.</li>
<li>Pages 1 2 3 .. next переделать на использование goTo. Особенно там где есть scoring options. Они там не передаются на след страницу.</li>
<li>Использовать &lt;label&gt; в формах везде.</li>
<li>Сделать так, чтобы последнее слово предоставлялось и только потом конец игры.</li>
<li>Поддержать правила Дина</li>
<li>Поддержать очковую систему Дина</li>
<li>Сделать страницы города-страны. Чтобы можно было смотреть там евенты-турниры-клубы-игроков-статистику.</li>
<li>Вернуть сравнение пользователей player_compare.php. Сделать ее по нормальному. Кроме того, там кажется ложные данные. Сейчас я ее пока отключил.</li>
<li>Сделать так, чтобы в случае протеста менеджеры клуба и модератор игры получали email. Когда игра отменяется, прислать емайл админу о перестройке рейтингов.</li>
<li>Сделать так, чтобы роли игроков в игре можно было менять до первого убиенного.</li>
<li>Сделать так, чтобы названия основных объектов (название клуба, название балловой системы, название лиги, название турнира) можно было задавать на разных языках.</li>
<li>Позволить менеджерам клубов мерджить игроков их клубов. Сделать удаление игроков не совершивших ни одной акции (показывать тех кто не подписан и тех кто не активировал пароль).</li>
<li>Ban не нужен. Дать вместо этого возможность менеджерам мерджить и удалять пользователей. Причем даже с не совпадающими email-ами. Дать возможность менеджеру менять ник пользователей и загружать картинку. Пользователям отправлять об этом предупреждения с возможностью откатить изменения. Дать возможность пользователям запрещать такие изменения.</li>
<li>Названия игр.</li>
<li>Починить api/get/scoring.php.</li>
<li>Сделать звуки. Счет ночью, предоставление слова, голосование. Музыка ночью.</li>
<li>Доделать рассадки.</li>
<li>Сделать приглашения на турниры. По возможности связать с рассадками.</li>
<li>Стандартизовать фотоальбомы. Они сейчас сильно отличаются по интерфейсу от других объектов. Сделать также как сделано с евентами-адресами-пользователями. Либерализовать ограничение по размеру фотографий (при этом фотографии уменьшать в размерах, чтобы не переполниться).</li>
<li>Фотоальбомы надо полностью уметь привязывать к турниру. Там сейчас нельзя создать альбом в турнире. Вообще хорошо бы альбомы переработать.</li>
<li>Столы в игре. Грузить игру в зависимости от стола, а не от залогиненного пользователя.</li>
<li>Возможность назначать права ведущего/менеджера на турнир/евент.</li>
<li>Если евенту назначается турнир, проверять, чтобы языки и даты были внутри турнира.</li>
<li>Сделать имена пользователей уникальными только в городе.</li>
<li>Отделить в базе данных недоигранные игры в отдельную таблицу</li>
<li>Баг - если стол попилися на троих, а потом на двоих, нужно третье переголосование. Посмотреть в упрощенном клиенте. Там вообще нельзя распилить на двоих при девятерых.</li>
<li>Сделать unsubscribe чуть удобнее. Иконки клубов и чекбокс чтобы отписаться сразу от всего.</li>
<li>Предлагать unsubscribed игрокам подписаться обратно когда они заходят на сайт.</li>
<li>Посылать письма игрокам сыгравшим в клубе где они не члены с предложением вступить. (см закоментированный код в send_emails.php и email_requests.php помеченный тагом #SUGGEST_JOINING_CLUB).</li>
<li>Редактирование комментариев.</li>
<li>Починить tag на photo.</li>
<li>Сделать предпочтительные ники для клубов. Во время выбора ника добавить чекбокс, что этот ник предпочтительный для соответствующего клуба.</li>
<li>Сделать страницу "изменения в рейтинге после игрового дня".</li>
<li>Переработать player_compare. Сделать все на javascript. Добавить туда графики.</li>
<li>Запоминать последнюю страницу клуба и при клике на клуб приходить на нее (даже если клуб другой). То же самое для евентов, адресов и игроков.</li>
<li>Сделать в письмах простые ссылки на сайт. На случай если кнопки не работают.</li>
<li>В игре с только одним языком убрать выбор языка.</li>
<li>Таблицы emails и logs надо иногда чистить.</li>
<li>Сделать фильтры по игроку во всех списках игр. Кроме того сделать страницы игрока на евенте, игрока в клубе, игрока по адресу.</li>
<li>Добавить возможность удалять игрока из евента заменяя на инкамера. См переменную INCOMERS_IMPLEMENTATION_COMPLETE в event_change_player.php</li>
<li>Сделать страницу incomers для админов и менеджеров. Чтобы их там можно было заменять на обычных игроков.</li>
<hr>

<li>Сделать действительных членов клуба, кандидатов и VIP. Сделать по ним фильтры и евенты только для них.</li>
<li>В игре пытаться переподключиться к серверу если отвалился через каждые 10 минут.</li>
<li>Наполнить чем нибудь главную страницу когда в клубе нет евентов</li>
<li>Стандартизовать названия игровых дней. К примеру "[название клуба]: [дата]" - это явно лучше, чем то, что сейчас.</li>
<li>Что будет если вывести игрока замечаниями ночью?</li>
<li>Почему иногда нет повторного голосования в игре?</li>
<li>Посмотреть, что не так с игрой 1252</li>
<li>Изменить сортировку рейтингов. Должна быть: рейтинг убыв, лучший игрок убыв, лучший ход убыв, победы убыв, количество игр убыв, id возр.</li>
<li>Максимальный рейтинг и дата максимального рейтинга.</li>
<li>Сделать страницу посвященную игре одной страницей с текстовым описанием лога игры - что происходило по порядку.</li>
<li>Forum email reminder should redirect to the associated event</li>
<li>Add default rules to club-edit dialog</li>
<li>Убедиться, что создать пользователя без email невозможно. Удалить всех пользователей без email.</li>
<li>Переработать view game на javascript.</li>
<li>Переработать фотки, чтобы действия над ними были на джаваскрипте.</li>
<hr>

<li>Разделить членов клуба на действительные и кандидаты. Только действительные будут получать приглашения на турниры.</li>
<li>Клубы с членством только по приглашению.</li>
<hr>

<li>Мобильный клиент.</li>
<li>Выделить чемпионаты в отдельный рейтинг.</li>
<li>Доделать страницу неизвестного игрока. Сделать так, чтобы менеджер мог ввести email игроку который его не имел раньше. И таким образом создать пользователя.</li>
<li>Если у евента пересекается время с другим и адрес одинаковый, надо предлагать пользователю их мерджить.</li>
<li>Исследовать почему tag на фотографии не приводит к отсылке email.</li>
<li>Сделать так, чтобы лог отправлял emails админу в серьезных случаях. Например: много login fails подряд с одного ip; ошибка при записи игры; пользователь отрицает, что участвовал в игре.</li>
<li>Поддержать iCalendar. Чтобы из email можно было добавлять евенты в свой календарь. См: http://www.julian-young.com/2009/07/07/php-ical-email/</li>
<li>Недельная рассылка об евентах на этой неделе.</li>
<li>Если пользователь помечает адрес как неиспользуемый и тот нигде не используется, предлагать удалить физически.</li>
<li>Протестировать игрока не вступившего ни в один клуб. Убедиться, что ничего не сыпется. Например попробовать создать фотоальбом и тд - посмотреть, что там ему можно.</li>
<li>Сделать страницы по городам и странам. Такие же, как по клубам.</li>
<li>Сделать так, чтобы ответы на email-ы шли клубам (по контактному email клуба), а не админу.</li>
<li>Удаление фотоальбомов и нескольких фотографий за один раз.</li>
<li>Группы и закрытые евенты. Приглашения на закрытые евенты.</li>
<li>Рассылка приглашений для вступления в новый клуб.<ul>
	<li>Когда регистрируется новый игрок, предложить ему получать такие сообщения.</li>
	<li>По умолчанию - нет.</li>
	<li>Когда создается новый клуб, рассылать письма игрокам которые согласны их получать в том же регионе, что и клуб.</li>
	<li>Письмо должно предложить вступление в новый клуб.</li>
</ul></li>	
<li>Автоматическое удаление лишних игроков.<ul>
	<li>Удалять игроков которые не дали email через неделю. Предупредить супервизоров их клубов.</li>
	<li>Удалять игроков которые не активировали аккаунт через месяц. Дважды предупредить.</li>
	<li>Удалять игроков которые не активны через год. Дважды предупредить.</li>
</ul></li>
<li>Музыка во время ночи. Возможность создавать плейлисты и указывать, какой из них использовать во время игры. Плейлисты должны жить на сервере. Клиент должен уметь синхронизироваться.</li>
<li>Переработать фильтры для рейтингов и статистики.
	Фильтровать статистику по:<ul>
	<li>времени</li>
	<li>языку</li>
	<li>полу игроков</li>
	<li>правилам</li>
</ul></li>
<li>Убедиться, что пользователя нельзя помечать в фотоальбомах и на фотках, которые они не имеют права смотреть.</li>
</ul>

<h3>То что можно сделать, но не горит:</h3>
<ul>
<li>Сделать так, чтобы при регистрации в клуб игрок указывал, кто его привел, либо где услышал о клубе. Тогда можно будет выяснять, кто приводит много знакомых (и давать им скидки), а также изучать где реклама эффективнее.</li>
<li>Собирть дни рождения. Показывать игрокам начальную страницу со всеми сообщениями, которые их касаются, со всеми событиями, которые их касаются, с поздравлениями с ДР и тп. На манер фейсбука.</li>
<li>Группы пользователей. Чтобы можно было отправлять сообщения только выбранной группе. Делать игровые дни, на которые приглашены только выбранные игроки и тп.</li>
<li>Страница статистики среднего пользователя. Сколько усредненный пользователь сыграл игр, какой набрал рейтинг и тп.</li>
<li>Игровые дни могут быть видимы не всем игрокам. Например, игровой день видный только членам клуба.</li>
</ul>
<hr><hr><hr>
<h3 id="voting">Coding votes design.</h3>
<pre>
------------------------------------ 1 letter
-- v - voted to
-- b - was voted by
------------------------------------ 2 letter
-- c - critical
-- n - non critical
------------------------------------ 3 letter
-- d - decisive
-- s - split
-- i - insufficient
------------------------------------ 4 letter
-- c - to civilian
-- s - to sheriff
-- m - to mafia
---------------------------------------------
ALTER TABLE `players` ADD COLUMN `vcdc` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vcss` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vcim` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vcsc` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vcis` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vcdm` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vcic` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vcds` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vcsm` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vndc` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vnss` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vnim` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vnsc` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vnis` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vndm` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vnic` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vnds` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `vnsm` TINYINT NOT NULL;

ALTER TABLE `players` ADD COLUMN `bcdc` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bcss` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bcim` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bcsc` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bcis` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bcdm` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bcic` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bcds` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bcsm` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bndc` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bnss` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bnim` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bnsc` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bnis` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bndm` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bnic` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bnds` TINYINT NOT NULL;
ALTER TABLE `players` ADD COLUMN `bnsm` TINYINT NOT NULL;

ALTER TABLE `players` DROP COLUMN `voted_civil`;
ALTER TABLE `players` DROP COLUMN `voted_mafia`;
ALTER TABLE `players` DROP COLUMN `voted_sheriff`;
ALTER TABLE `players` DROP COLUMN `voted_by_civil`;
ALTER TABLE `players` DROP COLUMN `voted_by_mafia`;
ALTER TABLE `players` DROP COLUMN `voted_by_sheriff`;
</pre>
</a>